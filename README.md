# Quantitative Stock Ranking System

A Python-based tool to convert financial data from HTML tables to Excel and rank companies based on key financial metrics such as EPS, P/E Ratio, Net Profit, and Net Worth. The system normalizes these metrics, applies user-defined weights, and generates a composite score to rank companies, outputting the results to Excel files.

- <b>If you want the sorted excel file it is inside</b> ```stock_score_results```

## Table of Contents
- [Project Overview](#project-overview)
- [Features](#features)
- [Requirements](#requirements)
- [Setup Instructions](#setup-instructions)
- [Usage](#usage)
- [File Structure](#file-structure)
- [How It Works](#how-it-works)
- [License](#license)
- [Example output](#example-output)
- [Screenshot of the excel file](#screenshot-of-the-excel-file)

## Project Overview
This project provides a quantitative approach to rank companies based on financial metrics. It processes an HTML file containing financial data, converts it to an Excel file, and performs a scoring analysis using normalized values of Earnings Per Share (EPS), Price-to-Earnings (P/E) Ratio, Net Profit, and Net Worth. The system uses user-defined weights to compute a composite score for ranking companies.

The results are saved as Excel files in the specified output directory and a dedicated results folder. The system is designed to be flexible, allowing users to adjust weights and file paths through a configuration file.



## Features
- **HTML to Excel Conversion**: Converts financial data from an HTML table to an Excel file.
- **Data Normalization**: Normalizes EPS, P/E Ratio, Net Profit, and Net Worth for consistent scoring.
- **Weighted Scoring**: Computes a composite score based on user-defined weights for each metric.
- **Error Handling**: Validates file paths and required columns, providing clear error messages.
- **Configurable**: Allows customization of file paths and weights via a `config.py` file.
- **Output Management**: Saves sorted results to multiple locations for easy access.

## Requirements
- Python 3.6 or higher
- Required Python packages:
  - `pandas`
  - `openpyxl`
- An HTML file containing financial data in a tabular format (HTML stocks data of Q4 2082 is provided)
- A valid output directory for saving results

## Setup Instructions
1. **Clone the Repository**:
   ```bash
   git clone https://github.com/gyawaliaadim/Quantitative-Stock-Ranking-System-in-Python.git
   cd quantitative-stock-ranking
   ```

2. **Install Dependencies**:
   Install the required Python packages using pip:
   ```bash
   pip install pandas openpyxl
   ```

3. **Prepare the HTML File**:
   Ensure you have an HTML file (`data.html`) with financial data in a table format. The table must include the following columns (Stock data of Q4 of 2082 is already provided):
   - `Close`
   - `EPS`
   - `P/E Ratio`
   - `Net Profit`
   - `Net Worth`

4. **Configure the System**:
   Edit the `config.py` file to set the correct paths and weights:
   - `DATA_HTML_PATH`: Path to the input HTML file.
   - `OUTPUT_PATH`: Directory where the sorted results will be saved.
   - `WEIGHTS`: Dictionary of weights for EPS, P/E Ratio, Net Profit, and Net Worth (must sum to 1).

   `config.py`:
   ```python
   DATA_HTML_PATH = r"C:\Users\YourName\Stock market project\data.html"
   OUTPUT_PATH = r"C:\Users\YourName\Downloads"
   WEIGHTS = {
       'EPS': 0.30,
       'P/E Ratio': 0.20,
       'Net Profit': 0.30,
       'Net Worth': 0.20
   }
   ```

5. **Ensure Valid Paths**:
   Verify that the HTML file and output directory exist and are accessible.

## Usage
1. **Run the Conversion Script**:
   Execute the `convertToExcel()` function to convert the HTML data to an Excel file:
   ```bash
   python main.py
   ```
   This will:
   - Copy the HTML file to the `stock_score_results` folder.
   - Convert the HTML table to an Excel file (`processed_data.xlsx`).
   - Update `config.py` with the paths to the Excel file and script directory.

2. **Run the Analysis Script**:
   Execute the `analysis()` function to rank companies:
   ```bash
   python main.py
   ```
   This will:
   - Read the Excel file generated by `convertToExcel()`.
   - Normalize the financial metrics.
   - Calculate a composite score based on the weights.
   - Save the sorted results to `Sorted_Companies.xlsx` in both the output directory and the `stock_score_results` folder.

3. **Check Outputs**:
   - `processed_data.xlsx`: Contains the processed financial data from the HTML file.
   - `Sorted_Companies.xlsx`: Contains the ranked companies with their composite scores.

## File Structure
```
quantitative-stock-ranking/
│
├── config.py               # Configuration file for paths and weights
├── main.py                 # Main script containing convertToExcel() and analysis()
├── stock_score_results/    # Folder for storing processed data and results
│   ├── data.html           # Copied input HTML file
│   ├── processed_data.xlsx # Converted Excel file
│   ├── Sorted_Companies.xlsx # Sorted results with composite scores
├── data.html               # Input HTML file (user-provided)
├── README.md               # Project documentation
```

## How It Works
1. **HTML to Excel Conversion**:
   - The `convertToExcel()` function reads an HTML file using `pandas.read_html()`.
   - Converts financial values with units (e.g., "Lac," "Crore") to numeric values.
   - Saves the processed data to an Excel file and updates `config.py` with the new file path.

2. **Data Analysis and Ranking**:
   - The `analysis()` function reads the Excel file.
   - Normalizes financial metrics:
     - EPS: Divided by stock price (higher is better).
     - P/E Ratio: Inverted for positive values, scaled for negative values (lower is better).
     - Net Profit and Net Worth: Divided by their respective maximum values.
   - Computes a composite score using user-defined weights.
   - Sorts companies by composite score and saves the results to Excel files.

3. **Error Handling**:
   - Validates the existence of the HTML file and output directory.
   - Checks for required columns in the Excel data.
   - Provides informative error messages if issues occur.

## License
This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Example output:
```bash
>main.py
Converting the html to excel
c:\Users\Aadim Gyawali\Stock market project\convertToExcel.py:44: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df = tables[0].applymap(convert_value)
✅ Processed data saved to: c:\Users\Aadim Gyawali\Stock market project\stock_score_results\processed_data.xlsx
✅ Updated config.py with new Excel file path and script directory.
Analyzing the excel.
✅ Scoring complete!
   Sorted companies saved to: C:\Users\Aadim Gyawali\Downloads\Sorted_Companies.xlsx
   Copy also saved to: c:\Users\Aadim Gyawali\Stock market project\stock_score_results\Sorted_Companies.xlsx
```

## Screenshot of the excel file
<img width="1122" height="377" alt="image" src="https://github.com/user-attachments/assets/e2397d77-b4a7-4f5f-be88-3efc422843e6" />
